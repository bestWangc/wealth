{extend name="layout/layout"}

{block name="body"}
<link rel="stylesheet" href="/static/manage/css/myown.css">
<body class="gray-bg">
    <div class="wrapper wrapper-content">
        <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>矿工</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <div class="pull-right white bg-green left-radius" >
                                    <i class="fa fa-eye fa-5x"></i>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <h4>{$workerNum}&nbsp;人</h4>
                                <a class="btn btn-success btn-sm" href="{:url('/index/finance/buyWorker?type=1')}" role="button">购买</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>钱包</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <div class="pull-right white bg-blue left-radius" >
                                    <i class="fa fa-credit-card fa-5x"></i>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <h4>{$money}&nbsp;元</h4>
                                <a class="btn btn-success btn-sm" href="{:url('/index/recharge/index')}" role="button">充值</a>
                                <a class="btn btn-warning btn-sm" href="{:url('/index/extract/index?type=1')}" role="button">提现</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>昨日利息</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <div class="pull-right white bg-red left-radius" >
                                    <i class="fa fa-comments fa-5x"></i>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <h4>{$yesterdayIncome}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>签到</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <div class="pull-right white bg-brown left-radius" >
                                    <i class="fa fa-users fa-5x"></i>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <strong>
                                    {if($signStatus)}
                                    <button class='btn btn-default btn-sm'>已签到</button>
                                    {else /}
                                    <a class="btn btn-success btn-sm singBtn" href="javascript:;">签 到</a>
                                    {/if}
                                </strong>
                                <br>
                                <strong>每日签到赠送0.2元</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h4>最近10笔收支记录</h4>
                <a href="/index/finance/index" class="pull-right" style="margin-right: 1rem;">查看全部</a>
                <div class="clearfix"></div>
            </div>
            <div class="ibox-content">
                <div class="row row-lg">
                    <div class="col-sm-12">
                        <div class="example-wrap">
                            <div class="example">
                                <input type="hidden" class="data" value="{$moneyHistory}">
                                <table id="moneyHistory"  data-mobile-responsive="true"  data-pagination="true" data-page-list=[10]>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
{/block}

{block name="my-js"}
<script>
    $(function () {
        var btt_data = $('.data').val();
        btt_data = JSON.parse(btt_data);
        $('#moneyHistory').bootstrapTable({
                data: btt_data,
                columns: [{
                    field:"action_type",
                    title:"类别",
                    formatter: function (value, row, index) {
                        return getMainLastStatus(value);
                    }
                }, {
                    field:"epoints",
                    title:"收入/支出",
                    formatter: function (value, row, index) {
                        if (value > 0) {
                            return '<span style="color: red">收入</span>';
                        } else {
                            return "支出";
                        }
                    }
                }, {
                    field:"epoints",
                    title:"金额"
                }, {
                    field:"create_time",
                    title:"时间"
                }, {
                    field:"text",
                    title:"说明"
                }, {
                    field:"original",
                    title:"之前"
                }, {
                    field:"after",
                    title:"之后"
                }]
        });

        $('.singBtn').click(function () {
            //加载遮罩层
            layer.load(1, {
                shade: [0.5,'#fff']
            });

            $.ajax({
                url : '/index/index/sign',
                type : "GET",
                dataType : "json",
                cache : false,
                success : function(res){
                    console.log(res);
                    var callingBack = '';
                    layer.closeAll('loading');
                    if(res.code == 0){
                        callingBack = function () {
                            window.location.reload();
                        };
                    }
                    layer.msg(res.msg,{time: 1000},callingBack);
                },
                error : function(data){
                    layer.closeAll('loading');
                    console.log(data);
                }
            });
        });
    });
</script>
{/block}
